{
  "version": 3,
  "sources": ["../../sse.js/lib/sse.js"],
  "sourcesContent": ["/**\n * Copyright (C) 2016 Maxime Petazzoni <maxime.petazzoni@bulix.org>.\n * All rights reserved.\n */\n\nvar SSE = function (url, options) {\n  if (!(this instanceof SSE)) {\n    return new SSE(url, options);\n  }\n\n  this.INITIALIZING = -1;\n  this.CONNECTING = 0;\n  this.OPEN = 1;\n  this.CLOSED = 2;\n\n  this.url = url;\n\n  options = options || {};\n  this.headers = options.headers || {};\n  this.payload = options.payload !== undefined ? options.payload : '';\n  this.method = options.method || (this.payload && 'POST' || 'GET');\n  this.withCredentials = !!options.withCredentials;\n\n  this.FIELD_SEPARATOR = ':';\n  this.listeners = {};\n\n  this.xhr = null;\n  this.readyState = this.INITIALIZING;\n  this.progress = 0;\n  this.chunk = '';\n\n  this.addEventListener = function(type, listener) {\n    if (this.listeners[type] === undefined) {\n      this.listeners[type] = [];\n    }\n\n    if (this.listeners[type].indexOf(listener) === -1) {\n      this.listeners[type].push(listener);\n    }\n  };\n\n  this.removeEventListener = function(type, listener) {\n    if (this.listeners[type] === undefined) {\n      return;\n    }\n\n    var filtered = [];\n    this.listeners[type].forEach(function(element) {\n      if (element !== listener) {\n        filtered.push(element);\n      }\n    });\n    if (filtered.length === 0) {\n      delete this.listeners[type];\n    } else {\n      this.listeners[type] = filtered;\n    }\n  };\n\n  this.dispatchEvent = function(e) {\n    if (!e) {\n      return true;\n    }\n\n    e.source = this;\n\n    var onHandler = 'on' + e.type;\n    if (this.hasOwnProperty(onHandler)) {\n      this[onHandler].call(this, e);\n      if (e.defaultPrevented) {\n        return false;\n      }\n    }\n\n    if (this.listeners[e.type]) {\n      return this.listeners[e.type].every(function(callback) {\n        callback(e);\n        return !e.defaultPrevented;\n      });\n    }\n\n    return true;\n  };\n\n  this._setReadyState = function(state) {\n    var event = new CustomEvent('readystatechange');\n    event.readyState = state;\n    this.readyState = state;\n    this.dispatchEvent(event);\n  };\n\n  this._onStreamFailure = function(e) {\n    var event = new CustomEvent('error');\n    event.data = e.currentTarget.response;\n    this.dispatchEvent(event);\n    this.close();\n  }\n\n  this._onStreamAbort = function(e) {\n    this.dispatchEvent(new CustomEvent('abort'));\n    this.close();\n  }\n\n  this._onStreamProgress = function(e) {\n    if (!this.xhr) {\n      return;\n    }\n\n    if (this.xhr.status !== 200) {\n      this._onStreamFailure(e);\n      return;\n    }\n\n    if (this.readyState == this.CONNECTING) {\n      this.dispatchEvent(new CustomEvent('open'));\n      this._setReadyState(this.OPEN);\n    }\n\n    var data = this.xhr.responseText.substring(this.progress);\n    this.progress += data.length;\n    data.split(/(\\r\\n|\\r|\\n){2}/g).forEach(function(part) {\n      if (part.trim().length === 0) {\n        this.dispatchEvent(this._parseEventChunk(this.chunk.trim()));\n        this.chunk = '';\n      } else {\n        this.chunk += part;\n      }\n    }.bind(this));\n  };\n\n  this._onStreamLoaded = function(e) {\n    this._onStreamProgress(e);\n\n    // Parse the last chunk.\n    this.dispatchEvent(this._parseEventChunk(this.chunk));\n    this.chunk = '';\n  };\n\n  /**\n   * Parse a received SSE event chunk into a constructed event object.\n   */\n  this._parseEventChunk = function(chunk) {\n    if (!chunk || chunk.length === 0) {\n      return null;\n    }\n\n    var e = {'id': null, 'retry': null, 'data': '', 'event': 'message'};\n    chunk.split(/\\n|\\r\\n|\\r/).forEach(function(line) {\n      line = line.trimRight();\n      var index = line.indexOf(this.FIELD_SEPARATOR);\n      if (index <= 0) {\n        // Line was either empty, or started with a separator and is a comment.\n        // Either way, ignore.\n        return;\n      }\n\n      var field = line.substring(0, index);\n      if (!(field in e)) {\n        return;\n      }\n\n      var value = line.substring(index + 1).trimLeft();\n      if (field === 'data') {\n        e[field] += value;\n      } else {\n        e[field] = value;\n      }\n    }.bind(this));\n\n    var event = new CustomEvent(e.event);\n    event.data = e.data;\n    event.id = e.id;\n    return event;\n  };\n\n  this._checkStreamClosed = function() {\n    if (!this.xhr) {\n      return;\n    }\n\n    if (this.xhr.readyState === XMLHttpRequest.DONE) {\n      this._setReadyState(this.CLOSED);\n    }\n  };\n\n  this.stream = function() {\n    this._setReadyState(this.CONNECTING);\n\n    this.xhr = new XMLHttpRequest();\n    this.xhr.addEventListener('progress', this._onStreamProgress.bind(this));\n    this.xhr.addEventListener('load', this._onStreamLoaded.bind(this));\n    this.xhr.addEventListener('readystatechange', this._checkStreamClosed.bind(this));\n    this.xhr.addEventListener('error', this._onStreamFailure.bind(this));\n    this.xhr.addEventListener('abort', this._onStreamAbort.bind(this));\n    this.xhr.open(this.method, this.url);\n    for (var header in this.headers) {\n      this.xhr.setRequestHeader(header, this.headers[header]);\n    }\n    this.xhr.withCredentials = this.withCredentials;\n    this.xhr.send(this.payload);\n  };\n\n  this.close = function() {\n    if (this.readyState === this.CLOSED) {\n      return;\n    }\n\n    this.xhr.abort();\n    this.xhr = null;\n    this._setReadyState(this.CLOSED);\n  };\n};\n\n// Export our SSE module for npm.js\nif (typeof exports !== 'undefined') {\n  exports.SSE = SSE;\n}\n"],
  "mappings": "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",
  "names": []
}
